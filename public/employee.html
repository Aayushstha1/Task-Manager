<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Employee Dashboard</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #6b73ff, #000dff);
  margin:0; padding:0;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh;
}
.dashboard {
  background:#fff; border-radius:15px;
  box-shadow:0 15px 40px rgba(0,0,0,0.3);
  width:90%; max-width:900px;
  padding:30px;
  display:flex; flex-direction:column;
  gap:20px;
}
#logoutBtn {
  background:#dc3545; color:#fff; border:none;
  padding:10px 15px; border-radius:8px;
  cursor:pointer; font-weight:bold;
  align-self:flex-end; transition:0.3s;
}
#logoutBtn:hover { background:#a71d2a; }
h2 { text-align:center; color:#333; margin-bottom:5px; }
.profile {
  display:flex; justify-content:space-between;
  align-items:center; background:#f1f4ff;
  padding:15px; border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.profile div { font-weight:500; }
.tasks-summary {
  display:flex; justify-content:space-around;
  gap:20px;
}
.summary-box {
  flex:1; background:#e9f1ff; padding:15px;
  border-radius:12px; text-align:center;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.summary-box h3 { margin-bottom:10px; }
.summary-box p { font-size:20px; font-weight:bold; margin:0; }
#tasksContainer {
  display:flex; flex-direction:column; gap:15px;
  max-height:400px; overflow-y:auto;
}
.task {
  display:flex; justify-content:space-between; align-items:center;
  padding:15px; border-radius:12px; background:#f1f4ff;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.task:hover { transform:translateY(-2px); transition:0.3s; }
.task div { flex:1; }
.task button {
  padding:8px 14px; border:none; border-radius:8px;
  background:#28a745; color:#fff; cursor:pointer; font-weight:bold;
  transition:0.3s;
}
.task button:hover { background:#218838; }
.status {
  padding:5px 12px; border-radius:6px; font-weight:600; font-size:14px;
}
.status.assigned { background:#ffc107; color:#000; }
.status.completed { background:#28a745; color:#fff; }
@media(max-width:600px){
  .profile, .tasks-summary { flex-direction:column; gap:10px; }
  #logoutBtn { align-self:center; width:100%; }
}
</style>
</head>
<body>

<div class="dashboard">
  <button id="logoutBtn">Logout</button>
  <h2>Employee Dashboard</h2>

  <div class="profile" id="profileInfo">
    <div>Loading profile...</div>
  </div>

  <div class="tasks-summary">
    <div class="summary-box">
      <h3>Completed Tasks</h3>
      <p id="completedCount">0</p>
    </div>
    <div class="summary-box">
      <h3>Pending Tasks</h3>
      <p id="pendingCount">0</p>
    </div>
  </div>

  <div id="tasksContainer">Loading tasks...</div>
</div>

<script>
// Fetch profile info
async function loadProfile() {
  const res = await fetch('/me');
  if(res.ok){
    const data = await res.json();
    document.getElementById('profileInfo').innerHTML = `
      <div><strong>Name:</strong> ${data.username}</div>
      <div><strong>Employee ID:</strong> ${data.employee_id}</div>
      <div><strong>Role:</strong> ${data.role}</div>
    `;
  }
}

// Fetch tasks and summary
async function loadTasks() {
  const res = await fetch('/tasks');
  const tasks = await res.json();
  const container = document.getElementById('tasksContainer');
  container.innerHTML = '';
  let completed=0, pending=0;

  if(tasks.length===0){
    container.innerHTML='<p style="text-align:center;color:#555;">No tasks assigned yet.</p>';
  }

  tasks.forEach(task=>{
    if(task.status==='Completed') completed++; else pending++;
    const div=document.createElement('div');
    div.className='task';
    div.innerHTML=`
      <div>
        <strong>${task.title}</strong><br>
        ${task.description}<br>
        <span class="status ${task.status.toLowerCase()}">${task.status}</span>
      </div>
      ${task.status==='Assigned'? `<button onclick="markComplete(${task.id})">Mark Completed</button>`:''}
    `;
    container.appendChild(div);
  });

  document.getElementById('completedCount').textContent = completed;
  document.getElementById('pendingCount').textContent = pending;
}

// Mark task as completed
async function markComplete(taskId){
  const res = await fetch('/employee/submit-task',{
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify({ taskId })
  });
  if(res.ok){
    alert('Task marked as completed!');
    loadTasks();
  } else alert(await res.text());
}

// Logout
document.getElementById('logoutBtn').addEventListener('click', async ()=>{
  if(confirm('Do you really want to logout?')){
    const res = await fetch('/logout',{method:'POST'});
    if(res.ok) window.location.href='index.html';
  }
});

// Initialize
loadProfile();
loadTasks();
</script>

</body>
</html>
